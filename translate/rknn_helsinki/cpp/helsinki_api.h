#ifndef HELSINKI_API_H
#define HELSINKI_API_H

#include <stddef.h>  // for size_t

#ifdef __cplusplus
extern "C" {
#endif

// ============================================================
// Helsinki Translation API
// 实时ASR翻译场景专用接口
// 线程安全，支持高频调用
// ============================================================

// ============================================================
// 1. 初始化会话
// ============================================================
// 功能: 加载模型和tokenizers，初始化翻译会话
// 参数:
//   encoder_path  - encoder模型路径 (.rknn文件)
//   decoder_path  - decoder模型路径 (.rknn文件)
//   source_spm    - source tokenizer文件 (.spm文件)
//   target_spm    - target tokenizer文件 (.spm文件)
//   vocab_txt     - 词汇表文件 (.txt文件)
//   verbose       - 详细日志开关 (0=关闭, 1=开启)
// 返回值:
//   0  - 成功
//   -1 - 失败
// 注意:
//   - 应该在应用启动时调用一次
//   - 重复调用会返回警告但不会出错
//   - 此函数不是线程安全的，应在主线程调用
// ============================================================
int init_translation_session(
    const char* encoder_path,
    const char* decoder_path,
    const char* source_spm,
    const char* target_spm,
    const char* vocab_txt,
    int verbose
);

// ============================================================
// 2. 执行翻译（核心接口，高频调用）
// ============================================================
// 功能: 翻译输入文本
// 参数:
//   input_text    - 输入文本 (UTF-8编码)
//   output_buffer - 输出缓冲区 (用于存储翻译结果)
//   buffer_size   - 输出缓冲区大小 (字节)
// 返回值:
//   0  - 成功
//   -1 - 失败
// 线程安全: 是 (内部使用mutex保护)
// 性能:
//   - 首次调用: ~100-200ms (模型warmup)
//   - 后续调用: ~50-100ms (取决于文本长度)
// 适用场景:
//   - 实时ASR翻译
//   - 可以每秒调用多次
//   - 单次失败不影响后续调用
// 注意:
//   - 必须先调用 init_translation_session()
//   - 如果输出超过buffer_size，会自动截断并警告
// ============================================================
int run_translation(
    const char* input_text,
    char* output_buffer,
    size_t buffer_size
);

// ============================================================
// 3. 释放会话资源
// ============================================================
// 功能: 释放所有已分配的资源
// 返回值:
//   0  - 成功
// 注意:
//   - 应该在应用退出时调用一次
//   - 调用后必须重新init才能使用翻译功能
//   - 此函数不是线程安全的，应在主线程调用
// ============================================================
int release_translation_session();

// ============================================================
// 4. 查询会话状态
// ============================================================
// 功能: 检查会话是否已初始化
// 返回值:
//   1  - 已初始化
//   0  - 未初始化
// 线程安全: 是 (只读操作)
// 用途:
//   - Java层可以检查状态再调用翻译
//   - 防止未初始化时调用翻译导致错误
// ============================================================
int is_session_initialized();

// ============================================================
// 5. 设置日志模式
// ============================================================
// 功能: 动态调整日志详细程度
// 参数:
//   verbose - 0=关闭详细日志, 1=开启详细日志
// 用途:
//   - 开发阶段: verbose=1 便于调试
//   - 生产环境: verbose=0 减少日志开销
// 注意:
//   - 可以在运行时动态调用
//   - 不影响错误日志的输出
// ============================================================
void set_verbose_mode(int verbose);

// ============================================================
// 6. 获取版本信息（可选）
// ============================================================
// 功能: 返回API版本字符串
// 返回值: 版本字符串 (例如: "1.0.0")
// ============================================================
const char* get_api_version();

#ifdef __cplusplus
}
#endif

#endif // HELSINKI_API_H